<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link rel="icon" href="data:,">
    <title>Preview Open DB</title>
</head>
<body>
    <button class="bt-delete">delete db</button>

    <!--inject:start-->
    <script src="../dist/open-db.js"></script>
    <!--inject:end-->

    <script>
        const { openDB, deleteDB } = window['open-db'];

        const dbName = 'db';

        document.querySelector('.bt-delete').addEventListener('click', () => {
            deleteDB(dbName);
        });

        //console.log(openDB);
        const test = async () => {

            console.log('=========================================================');
            console.log('key-value setItem/getItem');
            let odb = openDB(dbName, 'store-key-value');
            //console.log(odb);

            let v = await odb.getItem('key');
            console.log('getItem key', v);

            await odb.setItem('key', 'value');
            v = await odb.getItem('key');
            console.log('getItem key', v);
            console.assert(v === 'value');

            await odb.setItem('key', 'value2');
            v = await odb.getItem('key');
            console.log('getItem key', v);
            console.assert(v === 'value2');


            await odb.setItem('id', 'id-value');
            v = await odb.getItem('id');
            console.log('getItem id', v);
            console.assert(v === 'id-value');

            const obj = {
                id: 'id-value',
                name: 'name-value',
                age: 'age-value'
            };
            await odb.setItem('obj', obj);
            v = await odb.getItem('obj');
            console.log('getItem obj', v);
            console.assert(JSON.stringify(v) === JSON.stringify(obj));

            await odb.removeItem('obj');
            v = await odb.getItem('obj');
            console.log('getItem obj after removeItem', v);
            console.assert(typeof v === 'undefined');

            await odb.clear();
            v = await odb.getItem('key');
            console.log('getItem key after clear', v);
            console.assert(typeof v === 'undefined');

            console.log('close db');
            odb.close();

            console.log('=========================================================');
            console.log('autoIncrement addItem/getItem');


            odb = openDB(dbName, 'store-auto-increment', true);

            v = await odb.getItem('key');
            console.log('getItem key', v);

            const r = await odb.addItem('value');
            if (r.error) {
                console.error(r.error);
            }
        
            v = await odb.getItem('key');
            console.log('getItem key', v);
        };

        test();

    </script>
</body>
</html>
